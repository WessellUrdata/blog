---
import { getCollection } from "astro:content";
import dayjs from "dayjs";

const posts = await getCollection("blog");

posts.sort((a, b) => {
  return dayjs(b.data.date).unix() - dayjs(a.data.date).unix();
});
---

<span class="flex my-2">
  <h1 class="text-2xl font-bold text-accent mr-auto">Blog posts ✍️☺️</h1>

  <a href="/rss.xml" class="ml-auto btn btn-sm btn-outline btn-accent" aria-label="Link to get RSS feed">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" class="h-4">
      <path
        d="M3 3C12.9411 3 21 11.0589 21 21H18C18 12.7157 11.2843 6 3 6V3ZM3 10C9.07513 10 14 14.9249 14 21H11C11 16.5817 7.41828 13 3 13V10ZM3 17C5.20914 17 7 18.7909 7 21H3V17Z"
      ></path>
    </svg>
    <span class="hidden sm:block">RSS Feed</span>
  </a>
</span>

{
  posts.map((post) => (
    <div class="py-4 space-y-2">
      <a
        class="text-2xl font-semibold text-accent hover:brightness-75 transition"
        href={post.collection + "/" + post.slug}
      >
        {post.data.title}
      </a>
      <span class="flex text-sm gap-x-1">
        {dayjs(post.data.date).format("YYYY-MM-DD")}
        <span class="badge badge-accent badge-outline mx-0.5 p-2 text-xs">{post.data.category}</span>
      </span>
      <p>{post.data.description}</p>
    </div>
  ))
}
